// === FILE: prisma/schema.prisma
// this is the prisma schema file that defines the local database.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id           Int            @id @default(autoincrement())
  name         String
  description  String?
  price        Int
  isPattern    Boolean        @default(false)
  patternURL   String?
  images       ProductImage[]
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updateAt     DateTime       @updatedAt
  sizeGuideId  Int?
  sizeGuide    SizeGuide?     @relation(fields: [sizeGuideId], references: [id])
  tags         String[]
  orderItems   OrderItem[]
  sizes        String[]
}

model Order {
  id        Int      @id @default(autoincrement())
  
  customerEmail   String
  customerName    String?
  shippingAddress String?

  isCustom     Boolean @default(false)
  designImages String[]
  customOrder  Json? // store as raw JSON
  status     String  @default("pending")
  isPaid     Boolean @default(false)
  totalPrice Int?
  orderItems OrderItem[]
  quantity   Int     @default(1)
  userId  String?
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   Int
  product   Product @relation(fields: [productId], references: [id])
  productId Int
  quantity  Int     @default(1)
  unitPrice Int     // Price at time of order (store for history)
  size      String?
  // Optionally, add more fields if needed (like customization info)
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String // hash this if you're doing credentials-based login
  name      String?
  role      String   @default("user") // useful for admin access
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders Order[]
  resetTokenHash     String?  @db.VarChar(128)
  resetTokenExpires  DateTime?
  emailChangeTokenHash  String?  @db.VarChar(128)
  emailChangeTokenExpires DateTime?
  emailChangeNew        String?  @unique
}

model CustomRequestLog {
  id        Int      @id @default(autoincrement())
  customer  String
  email     String
  garment   String
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model SizeGuide {
  id        Int       @id @default(autoincrement())
  name      String
  tableData Json // e.g. [["Size", "Bust", "Waist"], ["S", "34", "26"]]
  Product   Product[]
}

model ProductImage {
  id             Int           @id @default(autoincrement())
  product        Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId      Int
  url            String
  altText        String?
  order          Int // ‚Üê optional, for ordering images
  MediaLibrary   MediaLibrary? @relation(fields: [mediaLibraryId], references: [id])
  mediaLibraryId Int?
}

model MediaLibrary {
  id        Int            @id @default(autoincrement())
  url       String         @unique
  createdAt DateTime       @default(now())
  usedBy    ProductImage[] // optional relation if you want
}

model SiteSettings {
  id                 Int      @id @default(1) // singleton row
  purchasingPaused   Boolean  @default(false)
  updatedAt          DateTime @updatedAt
}
