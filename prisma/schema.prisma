// === FILE: prisma/schema.prisma
// this is the prisma schema file that defines the local database.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id           Int            @id @default(autoincrement())
  name         String
  description  String?
  price        Int
  isPattern    Boolean        @default(false)
  images       ProductImage[]
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updateAt     DateTime       @updatedAt
  sizeGuideId  Int?
  sizeGuide    SizeGuide?     @relation(fields: [sizeGuideId], references: [id])
  sizeGuideUrl String?
  tags         String[]
  orders       Order[]
}

model Order {
  id        Int      @id @default(autoincrement())
  productId Int? // optional for custom garments
  Product   Product? @relation(fields: [productId], references: [id])

  customerEmail   String
  customerName    String?
  shippingAddress String?
  customNotes     String?

  isCustom     Boolean @default(false)
  designImages String? // could be a Google Drive or image upload link
  customOrder  Json? // store as raw JSON
  occasion     String?
  sessionId  String?
  status     String  @default("pending")
  isPaid     Boolean @default(false)
  totalPrice Int?
  quantity   Int     @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String // hash this if you're doing credentials-based login
  name      String?
  role      String   @default("user") // useful for admin access
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CustomRequestLog {
  id        Int      @id @default(autoincrement())
  customer  String
  email     String
  garment   String
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model SizeGuide {
  id        Int       @id @default(autoincrement())
  name      String
  tableData Json // e.g. [["Size", "Bust", "Waist"], ["S", "34", "26"]]
  Product   Product[]
}

model ProductImage {
  id             Int           @id @default(autoincrement())
  product        Product       @relation(fields: [productId], references: [id])
  productId      Int
  url            String
  altText        String?
  order          Int // ‚Üê optional, for ordering images
  MediaLibrary   MediaLibrary? @relation(fields: [mediaLibraryId], references: [id])
  mediaLibraryId Int?
}

model MediaLibrary {
  id        Int            @id @default(autoincrement())
  url       String         @unique
  createdAt DateTime       @default(now())
  usedBy    ProductImage[] // optional relation if you want
}
